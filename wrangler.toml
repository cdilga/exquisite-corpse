name = "exquisite-corpse"
main = "src/index.js"
compatibility_date = "2024-12-20"
compatibility_flags = ["nodejs_compat"]

# Enable automatic workers.dev subdomain
workers_dev = true

# Durable Objects configuration (top-level – useful for local dev/default deployment)
[[durable_objects.bindings]]
name = "GAME_ROOM"
class_name = "GameRoom"

# KV namespace for sharing stories (local dev - persisted locally)
[[kv_namespaces]]
binding = "SHARED_STORIES"
id = "shared-stories-local"
preview_id = "shared-stories-preview"

# Migrations (top-level – inherited by environments)
[[migrations]]
tag = "v1"
new_sqlite_classes = ["GameRoom"]

# Production deployment configuration
[env.production]
name = "exquisite-corpse"
vars = { ENVIRONMENT = "production" }
routes = [
  { pattern = "exquisite-corpse.dilger.dev/*", zone_name = "dilger.dev" }
]

# Repeat the Durable Object binding for production (required!)
[[env.production.durable_objects.bindings]]
name = "GAME_ROOM"
class_name = "GameRoom"

# KV namespace for production
[[env.production.kv_namespaces]]
binding = "SHARED_STORIES"
id = "TO_BE_CREATED"
